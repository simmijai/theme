{% extends 'base.html' %} {% load static %} {% block title %}Checkout - Belle E-commerce{% endblock %} {% block content %}
<!--Body Content-->
<div id="page-content" style="padding-top:60px;">
    <!-- Page Title -->
    <div class="page section-header text-center">
        <div class="page-title">
            <div class="wrapper">
                <h1 class="page-width">Checkout</h1>
            </div>
        </div>
    </div>
    <!-- End Page Title -->

    <div class="container mt-4">
        <div class="row">
            <!-- Left Column: Billing Section -->
            <div class="col-xl-6 col-lg-6 col-md-12 mb-4">

                <!-- Show Saved Addresses Button -->
                {% comment %} <div class="text-center mb-3">
                    <button id="show-address-btn" class="btn btn-outline-primary w-100 mb-2">
                        Select Delivery Address
                    </button>
                </div> {% endcomment %}

                <div class="row mb-4 gx-3">
    <div class="col-md-6">
        <button id="show-address-btn" class="btn btn-primary w-100 shadow-sm" type="button">
            Select Delivery Address
        </button>
    </div>

    <div class="col-md-6">
        <button id="change-address-btn" class="btn btn-outline-secondary w-100 shadow-sm" type="button">
            + Add New Address
        </button>
    </div>
</div>


                <!-- Saved Addresses List (hidden by default) -->
                <div id="address-list-container" style="display:none;" class="mb-3">
                    {% if addresses %}
                    <form method="POST" action="{% url 'orders_checkout' %}">
                        {% csrf_token %} {% for address in addresses %}
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="selected_address" id="address_{{ address.id }}" value="{{ address.id }}" {% if address.is_default %}checked{% endif %}>
                            <label class="form-check-label" for="address_{{ address.id }}">
                                {{ address.first_name }} {{ address.last_name }}, {{ address.address_line1 }}, {{ address.city }}, {{ address.country }}
                            </label>
                            <!-- Optional edit/delete icons -->
                            <div class="ms-3">
                                <a href="{% url 'edit_address' address.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                                <a href="{% url 'delete_address' address.id %}" class="btn btn-sm btn-outline-danger">Delete</a>

                            </div>
                        </div>
                        {% endfor %}
                    </form>
                    {% else %}
                    <p>You have no saved addresses.</p>
                    {% endif %}
                </div>

                <!-- Change Address Button -->
                {% comment %} <div class="text-center mb-3">
                    <button id="change-address-btn" class="btn btn-outline-primary">
                        + Add New Address
                    </button>
                </div> {% endcomment %}

                <!-- Billing Form (hidden by default) -->
                <div id="address-form-container" style="display:none;">
                    <div class="create-ac-content bg-light-gray p-4 rounded shadow-sm">
                        <form method="POST" action="{% url 'orders_checkout' %}">
                            {% csrf_token %}
                            <fieldset>
                                <h2 class="login-title mb-3">Billing details</h2>

                                <div class="row">
                                    <div class="form-group col-md-6 required">
                                        <label for="input-firstname">First Name <span class="required-f">*</span></label>
                                        <input name="first_name" id="input-firstname" type="text" class="form-control">
                                    </div>
                                    <div class="form-group col-md-6 required">
                                        <label for="input-lastname">Last Name <span class="required-f">*</span></label>
                                        <input name="last_name" id="input-lastname" type="text" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="form-group col-md-6 required">
                                        <label for="input-state">State <span class="required-f">*</span></label>
                                        <input name="state" id="input-state" type="state" class="form-control">
                                    </div>
                                    <div class="form-group col-md-6 required">
                                        <label for="input-phone">phone <span class="required-f">*</span></label>
                                        <input name="phone" id="input-phone" type="tel" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label for="input-address">House No./Building Name</label>
                                        <input name="address_line1" id="input-address" type="text" class="form-control">
                                    </div>
                                    <div class="form-group col-md-6 required">
                                        <label for="input-address-1">Road name /Area/colony<span class="required-f">*</span></label>
                                        <input name="address_line2" id="input-address-1" type="text" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label for="input-address-2">Near by Land Mark</label>
                                        <input name="address_2" id="input-address-2" type="text" class="form-control">
                                    </div>
                                    <div class="form-group col-md-6 required">
                                        <label for="input-city">City <span class="required-f">*</span></label>
                                        <input name="city" id="input-city" type="text" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="form-group col-md-6 required">
                                        <label for="input-postal_code">Pin Code <span class="required-f">*</span></label>
                                        <input name="postal_code" id="input-postal_code" type="text" class="form-control">
                                    </div>
                                    <div class="form-group col-md-6 required">
                                        <label for="input-country">Country <span class="required-f">*</span></label>
                                        <input name="country" id="input-country" type="text" class="form-control">
                                    </div>
                                </div>

                                <div class="form-check mb-3">
                                    <input type="checkbox" class="form-check-input" id="create-account" name="create_account">
                                </div>

                                <div class="form-group">
                                    <label for="order-notes">Order Notes</label>
                                    <textarea id="order-notes" class="form-control resize-both" rows="3"></textarea>
                                </div>

                                <div class="text-center mt-3">
                                    <button type="submit" class="btn btn-success" id="save-address-btn">Save Address</button>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>

            </div>

            <!-- Right Column: Product Table & Payment Section -->
            <div class="col-xl-6 col-lg-6 col-md-12 mb-4">
                <div class="your-order-payment">
                    <div class="your-order mb-4">
                        <h2 class="order-title mb-4">Your Order</h2>
                        <div class="table-responsive-sm order-table">
                            <table class="table table-bordered table-hover text-center bg-white">
                                <thead>
                                    <tr>
                                        <th class="text-left">Product Name</th>
                                        <th>Price</th>
                                        <th>Size</th>
                                        <th>Qty</th>
                                        <th>Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if cart_items %} {% for item in cart_items %}
                                    <tr>
                                        <td class="text-left">{{ item.product.name }}</td>
                                        <td>${{ item.product.price }}</td>
                                        <td>â€”</td>
                                        <td>{{ item.quantity }}</td>
                                        <td>${{ item.total_price }}</td>
                                    </tr>
                                    {% endfor %} {% else %}
                                    <tr>
                                        <td colspan="5">Your cart is empty.</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                                <tfoot class="font-weight-600">
                                    <tr>
                                        <td colspan="4" class="text-right">Shipping</td>
                                        <td>${{ shipping_cost }}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" class="text-right">Total</td>
                                        <td>${{ total_price }}</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="order-button-payment mt-4 text-end">
                    {% comment %} <button class="btn btn-primary px-4" type="submit">Continue</button> {% endcomment %}
                    <a href="{% url 'payment_page' %}" class="btn btn-primary px-4">Continue</a>

                </div>
                </div>
            </div>
        </div>

    </div>
</div>

</div>
<!--End Body Content-->

<script>
    document.getElementById("change-address-btn").addEventListener("click", function() {
        const formContainer = document.getElementById("address-form-container");
        formContainer.style.display = formContainer.style.display === "none" ? "block" : "none";
    });
    
    document.getElementById("show-address-btn").addEventListener("click", function() {
        const listContainer = document.getElementById("address-list-container");
        listContainer.style.display = listContainer.style.display === "none" ? "block" : "none";
    });
</script>
{% endblock %}